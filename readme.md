# 网易云 to Bilibili 全自动同步工具 (高级版)

这是一个功能强大的自动化Python脚本，旨在全自动地同步一个网易云音乐歌单到Bilibili收藏夹。它经过了多次功能迭代，特别为处理大型歌单和应对B站风控机制进行了优化，支持断点续传和失败重试，实现了高度的自动化和鲁棒性。

## ✨ 核心功能

- **智能歌单解析**:
    - **自动抓取**: 启动浏览器，用户只需登录一次网易云，即可全自动解析指定歌单的完整曲目列表。
    - **本地缓存**: 首次成功解析后，歌单会保存至 `playlist.json`。后续运行时可选择使用缓存，无需重复抓取。

- **强大的B站收藏引擎**:
    - **全速执行**: 脚本移除了不必要的延时，以最高效率执行搜索和收藏任务。
    - **智能筛选**: 自动过滤搜索结果，优先选择时长合适的视频，提高命中率。
    - **时间戳收藏夹**: 每次运行都会创建一个以当前时间命名的全新收藏夹 (如 `08291418`)，确保每次同步都独立存放，互不干扰。

- **高级容错与续传机制**:
    - **风控感知**: 能优雅地处理B站因API调用频繁而触发的风控。当遇到错误时，脚本会自动中断。
    - **进度自动保存**: 在因风控等原因中断后，脚本会将**当前任务及所有剩余未处理的歌曲**自动保存到 `fail.json` 文件中。
    - **失败重试**: 脚本启动时，如果检测到 `fail.json` 文件，会询问用户是想处理完整的URL歌单，还是仅处理上次失败的歌曲。
    - **断点续传 (按歌名)**: 用户可以选择从歌单中的**任意一首歌曲**开始执行任务。无需记住序号，只需输入歌曲名称的一部分，脚本即可自动定位并从那里继续，极大地方便了从中断处恢复。

- **配置化与用户友好**:
    - **配置缓存**: 网易云URL和B站Cookie均会保存到本地，并询问是否更新，操作便捷。
    - **清晰的指引**: 全程提供清晰的命令行提示，引导用户完成每一步操作。

## 🚀 快速开始

### 1. 环境准备

- **Python 3**: 确保已安装 Python 3.7 或更高版本。
- **Google Chrome**: 电脑上需要安装Chrome浏览器。

### 2. 文件与依赖安装

1.  **创建文件**: 在你的项目文件夹中，创建 `run.py` 和 `requirements.txt` 两个文件。
2.  **粘贴代码**: 将我们最终版的Python代码粘贴到 `run.py` 中。
3.  **填入依赖**: 在 `requirements.txt` 文件中，填入以下内容：
    ```
    bilibili-api-python
    undetected-chromedriver
    selenium
    ```
4.  **安装依赖**: 打开终端 (PowerShell, CMD等)，进入项目目录，运行以下命令：
    ```bash
    pip install -r requirements.txt
    ```

### 3. 运行与操作流程

在终端中运行主程序：
```bash
python run.py
```

脚本启动后，请按照以下顺序与提示交互：

1.  **选择歌单源**:
    - 如果检测到 `fail.json` (上次失败的记录)，会首先询问你处理哪个歌单：
        - 输入 `U`：处理完整的URL歌单。
        - 输入 `F`：仅处理上次失败的歌曲。

2.  **处理URL歌单**:
    - **输入URL**: 首次运行或选择更新时，输入网易云歌单的URL。
    - **登录网易云**: 脚本会打开一个Chrome浏览器。请在此浏览器中**手动登录**你的网易云账号。登录成功后，回到终端，**按`Enter`键**。
    - **使用缓存**: 如果 `playlist.json` 已存在，会询问是否重新从网页抓取。

3.  **设置起点 (断点续传)**:
    - 脚本会询问“是否要从特定歌曲开始？”。
        - 输入 `n`：从列表的第一首歌开始。
        - 输入 `y`：提示你**输入歌曲名**。你只需输入名字的一部分，脚本就会找到匹配的第一首歌作为起点。如果直接按`Enter`，则仍从头开始。

4.  **配置B站Cookie**:
    - 首次运行或选择更新时，需要输入 `SESSDATA` 和 `bili_jct`。请在浏览器登录B站后，按 `F12` -> `Application` -> `Cookies` 中找到它们。

5.  **开始自动同步**:
    - 完成上述步骤后，脚本将创建一个新的时间戳收藏夹，并开始全速同步，直到完成或被风控中断。

## 💡 推荐工作流 (处理超大歌单)

1.  **首次运行**: 选择 `U` (URL歌单)，从头开始，让脚本尽可能多地收藏，直到被风控中断。脚本会自动生成 `fail.json` 文件。
2.  **等待风控解除**: 等待一段时间 (通常是几小时)。
3.  **再次运行**: 脚本启动，这次选择 `F` (fail.json)，脚本会加载上次未完成的歌曲列表继续执行。
4.  **重复步骤2和3**，直到 `fail.json` 被自动删除，屏幕提示“全部任务成功完成！”。

## 📁 项目文件结构

```
.
├── run.py                   # 自动化主程序
├── requirements.txt         # Python 依赖列表
├── playlist.json            # (自动生成) 缓存的完整网易云歌单
├── fail.json                # (自动生成) 上次失败或未完成的歌曲列表
├── playlist_config.json     # (自动生成) 缓存的网易云URL
└── bili_cookie.json         # (自动生成) 缓存的B站Cookie
```